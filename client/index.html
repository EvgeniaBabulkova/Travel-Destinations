<!DOCTYPE html>
<html>
  <head>
    <title>My HTML Page</title>
    <link rel="stylesheet" href="./styles/form.css" />

    <style>
      /* Ensure the HTML and body take the full height of the viewport */
      html,
      body {
        margin: 0;
        padding: 0;
        width: 100%;
        background: wheat;
      }

      /* Hidden class */
      .hidden {
        display: none !important;
      }

      /* Style for main content area */
      .main-content {
        display: flex;
        flex: 1;
        overflow: hidden;
      }

      /* Style for sidebar */
      .sidebar {
        width: 300px;
        background-color: #edf1f1;
        padding: 1rem;
        height: 100vh; /* Full window height */
        position: fixed;
        top: 0;
        right: -400px; /* Initially hidden off-screen */
        z-index: 1000;
        transition: right 0.3s ease; /* Transition effect */
        display: flex;
        justify-content: center;
        align-items: center;
        opacity: 0.7;
      }

      .sidebar.show {
        right: 0; /* Slide in */
      }

      /* Style for iframe container */
      .iframe-container {
        flex: 1;
        display: flex;
        justify-content: center;
        align-items: center;
        overflow: auto;
      }

      /* Style for iframe */
      iframe {
        margin-top: 2rem;
        width: 1100px;
        height: 700px;
        border: none;
        zoom: 1.2;
      }

      /* Style the login message */
      #login-message {
        text-align: center;
        font-size: 18px;
        margin-top: 50px;
        color: #f00;
      }
    </style>
  </head>
  <body>
    <div id="navbar"></div>

    <div id="user-buttons" class="hidden"></div>

    <div id="login-message" class="hidden">
      <div class="login-container">
        <h2>Login</h2>
        <form id="loginForm">
          <div class="input-group">
            <label for="username">Email or Username</label>
            <input type="text" id="username" name="username" required />
          </div>
          <div class="input-group">
            <label for="password">Password</label>
            <input type="password" id="password" name="password" required />
          </div>
          <button type="submit">Login</button>
          <div class="error-message" id="errorMessage"></div>
        </form>
        <p class="signup-cta">
          Not a user? <a href="#" id="openSignupModal">Sign up here</a>
        </p>
      </div>
    </div>

    >

    <!-- Sign Up Modal -->
    <div id="signupModal" class="modal">
      <div class="modal-content">
        <span class="close" id="closeModal">&times;</span>
        <h2>Sign Up</h2>
        <form id="signupForm">
          <div class="input-group">
            <label for="signupUsername">Username</label>
            <input type="text" id="signupUsername" name="username" required />
          </div>
          <div class="input-group">
            <label for="signupEmail">Email</label>
            <input type="email" id="signupEmail" name="email" required />
          </div>
          <div class="input-group">
            <label for="signupPassword">Password</label>
            <input
              type="password"
              id="signupPassword"
              name="password"
              required
            />
          </div>
          <button type="submit">Sign Up</button>
          <div class="error-message" id="signupErrorMessage"></div>
        </form>
      </div>
    </div>

    <div class="main-content hidden">
      <div id="sidebar" class="sidebar">
        <p id="sidebar-content">Sidebar content</p>
        <button id="close-sidebar-button">Close</button>
      </div>

      <div class="iframe-container">
        <iframe id="worldMapIframe" src="worldMap.html"></iframe>
      </div>
    </div>

    <script type="module">
      import {
        loadNavbar,
        loadData,
        showSidebar,
        hideSidebar,
      } from "./utils.js";

      // Load the navbar, data, and set up iframe communication
      document.addEventListener("DOMContentLoaded", () => {
        loadNavbar();
        loadData();

        // Attach the hideSidebar function to the button
        document
          .getElementById("close-sidebar-button")
          .addEventListener("click", hideSidebar);
      });

      // Listen for messages from the iframe (gets info about the path clicked)
      window.addEventListener("message", (event) => {
        console.log("Message received from MAP:", event.data);
        if (event.data && event.data.pathId) {
          showSidebar(event.data.pathId);
        }
      });

      // Send a  test message to the iframe
      // const iframe = document.getElementById('worldMapIframe');
      // iframe.onload = () => {
      //     console.log('Iframe loaded, sending a test message to child html');
      //     iframe.contentWindow.postMessage({ action: 'testing' }, '*');
      // };
    </script>

    <script src="users.js"></script>
    <script src="formsHandle.js"></script>
    <script src="visitedPlaces.js"></script>
  </body>
</html>
